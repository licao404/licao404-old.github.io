---
title: 了解 HTTP
date: 2016-05-07 15:03:37
categories:
  - 计算机基础
  - 计算机网络
tags:
  - Web服务器
  - HTTP
  - TCP/IP
  - 前后端
---
![](http://7xrvo9.com1.z0.glb.clouddn.com/2016.0507/macbook-926558.jpg)

>#### **OSI 七层模型指什么？**

OSI（Open System Interconnection）七层模型是国际标准化组织（ISO）制定的一个用于计算机或通信系统间互联的标准体系，它是一个七层的、抽象的模型，不仅包括一系列抽象的术语或概念，也包括具体的协议。

<!--more-->
- **应用层** (Application)：，OSI 参考模型中的最高层；网络服务与最终用户的一个接口。各种应用程序协议，HTTP,FTP,TFTP,SMTP,SNMP,DNS,POP3;

- **表示层**（Presentation Layer）：OSI 参考模型中的第六层；数据的表示、安全、压缩。在表示层，数据将按照网络能理解的方案进行格式化，这种格式化也因所使用网络的类型不同而不同；表示层管理数据的解密与加密，如系统口令的处理；除此之外，表示层协议还对图片和文件格式信息进行解码和编码。

- **会话层**（Session Layer）：OSI 参考模型中的第五层；负责在网络中的两节点之间建立、维持和终止通信。 会话层的功能包括：建立通信链接，保持会话过程通信链接的畅通，同步两个节点之间的对话，决定通信是否被中断以及通信中断时决定从何处重新发送。

- **传输层**（Transport）：OSI 参考模型的第四层；定义传输数据的协议端口号，以及流控和差错效验。协议有：`TCP` 、`UDP`，数据包一旦离开网卡即进入网络传输层；

- **网络层**（Network）：OSI 参考模型的第三层；进行逻辑地址寻址，实现不同网络之间的路径选择。协议有：`ICMP` 、`IGMP` 、`IP（IPV4 IPV6）` 、 `ARP` 、`RARP`；

- **数据链路层** (Link) ：OSI 参考模型的第二层；建立逻辑连接、进行硬件地址寻址、差错校验等功能。（由底层网络定义协议）
将比特组合成字节进而组合成帧，用MAC地址访问介质，错误发现但不能纠正；

- **物理层**（Physical Layer）：OSI 参考模型的最低层；该层包括物理连网媒介，如电缆连线连接器。物理层的协议产生并检测电压以便发送和接收携带数据的信号。用户要传递信息就要利用一些物理媒体，如双绞线、同轴电缆等，但具体的物理媒体并不在OSI的7层之内，有人把物理媒体当做第0层，物理层的任务就是为它的上一层提供一个物理连接，以及它们的机械、电气、功能和规程特性。

>#### **HTTP 的工作原理是什么？**

HTTP协议（超文本传输协议）定义了Web客户端如何从Web服务器请求Web页面，以及服务器如何将Web页面传送给客户端。HTTP协议采用了请求/响应模型。客户端向服务器端发送一个请求报文（包含请求方法、URL、协议版本、请求头部和请求数据）。服务器端以一个状态作为响应（包括协议的版本、成功或错误代码、服务器信息、响应头和响应数据）。断开连接。HTTP是一种无状态协议。

>#### **URI 的格式是什么？常见的协议有哪些？**

URI（统一资源标识符）格式：**`<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<hash>`**

- **`<scheme>`** : 协议名，可能为 `HTTP`(默认端口80)、`HTTPS`(默认端口443)、`FTP`(默认端口21)、`SSH`(默认端口22)、`SMTP`(默认端口25)、`IMAP`(默认端口143)等；

- **`<user>`** : 用户名，HTTP 协议中不常见，SSH 协议一般是必须的；

- **`<password>`** : 密码，现在一般不会用明文的方式将密码写在 URI 上；

- **`<host>`** : 主机地址，域名或者 IP ，用于确定要连接的对象的地址；

- **`<port>`** : 端口号，用来区分主机上的进程，以便精确定位要连接的服务；

- **`<path>`** : 资源路径，用来确认资源存放的位置；

- **`<params>`** : 参数，以键值对的形式提供，以 `;` 分隔开。在例如 ftp 协议中可用于规定文件是以二进制形式还是文本形式传输。

- **`<query>`** : 查询字符串，`GET`请求传递参数；

- **`<hash>`** : 片段，定位文档位置；


>#### **HTTP 协议有几种和服务器交互的方法**

- **GET** : 请求服务器资源；

- **POST** : 向服务器发送数据，比如发送表单数据；

- **HEAD** : 请求服务器资源，但是服务器的响应中没有资源的body，只有资源的基本信息。可以用来获取资源元信息，通过状态吗查看资源是否存在，以及测试资源是否被修改；

- **TRACE** : 远程诊断服务器；

- **PUT** : 向服务器写入资源。让服务器用请求的主体部分创建一个请求 URL 命名的文档，如果存在就替换。出于安全原因，并不是所有的服务器都实现这个方法；

- **DELETE** : 删除服务器上的请求的资源。出于安全原因，服务器可能会不支持这个方法；

- **OPTIONS** : 询问服务器可以执行哪些方法；

- **CONNECT** : 用于代理进行传输，如使用SSL；

- ......

>#### **状态码 200，301， 304，403, 404, 500，503 分别代表什么意思**

- **200 : OK**  这是我们最想看到的状态码。服务器已经成功处理客户端发来的请求。由于和服务器交互方法的不同，返回的信息有所不同：使用 GET 方法时，对应请求资源的实体会随着状态码一起作为响应返回；而使用 HEAD 方法时，在响应中只返回首部，不会返回实体的主体部分；

- **301 : Moved Permanently**  永久性重定向。请求的资源已被分配新的URI，以后应使用资源现在所指的URI；

- **304 : Not Modified**  如果客户端发送了一个带条件的 GET 请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个状态码。304响应禁止包含消息体，因此始终以消息头后的第一个空行结尾;

- **403 : Forbidden** 服务器已经理解请求，但是拒绝执行它。这个请求不应该被重复提交,如果这不是一个 HEAD 请求，而且服务器希望能够讲清楚为何请求不能被执行，那么就应该在实体内描述拒绝的原因。当然服务器也可以返回一个404响应，假如它不希望让客户端获得任何信息;

- **404 : Not Found** 请求失败，请求所希望得到的资源未被在服务器上发现。404这个状态码被广泛应用于当服务器不想揭示到底为何请求被拒绝或者没有其他适合的响应可用的情况下。出现这个错误的最有可能的原因是服务器端没有这个页面。

- **500 : Internal Server Error** 服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。

- **503 : Service Unavailable** 由于临时的服务器维护或者 **过载**，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。如果能够预计延迟时间，那么响应中可以包含一个 Retry-After 头用以标明这个延迟时间。如果没有给出这个 Retry-After 信息，那么客户端应当以处理500响应的方式处理它。


>#### **报文有哪几部分组成？**

HTTP 报文是在 HTTP 应用程序之间发送的数据块。这些数据块以一些文本形式的 **元信息** 开头，描述报文的内容及含义，后面跟着可选的数据部分。
HTTP 报文由三部分组成：
- 起始行（start line）：对报文进行描述；
- 首部 （header）：包含属性；
- 主体（body）：包含可选的数据；


>#### **请求头的格式和作用是什么？给个范例截图说明**

随便打开一个网页，在开发者工具的 `NetWork` 中查看 `Request Headers` ，格式如下：

![](http://7xr868.com1.z0.glb.clouddn.com/task34/RequestHeaders.png)
其中包含 **请求方法** 、 **请求URI地址**、 **协议版本**，很明显截图中的请求方法为 `GET`，请求地址为 `/categories`，协议及其版本为 `HTTP/1.1`;

查看 `Response Headers`，格式如下：

![](http://7xr868.com1.z0.glb.clouddn.com/task34/ResponseHeaders.png)
其中包含 **协议版本** 、 **状态码**、 **原因短语**，很明显截图中的协议及其版本为 `HTTP/1.1`，状态码 `301`，原因短语是 `Moved Permanently`；


>#### **首部的格式和作用是什么？给个范例截图说明**

***HTTP首部字段是构成HTTP报文的要素之一。在客户端与服务器端以HTTP协议进行通信时，无论是请求还是响应都会使用首部字段，它能起到传递额外更多信息的作用。使用首部字段是为了给服务器和浏览器提供报文主体大小、所使用的语言、认证信息等内容。——《图解HTTP》***

HTTP 首部基本可以分为四类：通用首部、请求首部、响应首部、实体首部。
HTTP 首部格式是由首部字段名和首部字段值组成，中间用冒号‘:’分隔，例如 **Content-Type: text/html**,字段值可有多个，例如 **Keep-Alive: timeout=15, max=100** 。
- 通用首部：客户端和服务器端都能使用
 >- Cache-Control 控制缓存行为
 - Connection 逐跳首部、连接的管理
 - Date 日期，报文创建时间
 - ......

- 请求首部：从客户端往服务器端发送请求报文中所使用的字段，用于补充请求的附加信息、客户端信息和对响应内容相关的优先级等信息
![](http://7xr868.com1.z0.glb.clouddn.com/task34/%E8%AF%B7%E6%B1%82%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)
例如上图中:
 >- Accept 	告诉服务器能够发送那些媒体类型
 - Accept-Encoding 告诉服务器能够发送那些编码
 - Accept-Language 告诉服务器能够发送那些语言
 - Cookie 	客户端字符串
 - Host 接收请求的服务器的主机名和端口号
 - Referer 提供了包含当前请求URI的文档的URL，告诉服务器自己来源
 - .....（这里不再列出所有）

- 响应首部：由服务器端向客户端返回响应报文中所使用的字段，用于补充响应的附加信息、服务器信息以及对客户端的附加要求等信息。
![](http://7xr868.com1.z0.glb.clouddn.com/task34/%E5%93%8D%E5%BA%94%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)
例如上图中:
 >- Content-Encoding 主体编码格式
  - Content-Type 主体的MIME
  - ETag 主体的实体标记
  - Last-Modified 实体最后一次修改时间
  - Server 服务器应用软件名称和版本
  - .....（这里不再列出所有）

 - 实体首部：针对请求报文和响应报文使用的字段。补充了资源内容，更新时间等和实体相关的信息。


>#### **主体的作用是什么？给个范例**

![](http://7xr868.com1.z0.glb.clouddn.com/task34/%E4%B8%BB%E4%BD%93.png)

 - 用于包含所请求的数据内容；
 - 包含着返回的 HTML 文件的内容，即全部文本。


>#### **简述浏览器缓存是如何控制的**

缓存有服务器端缓存和客户端缓存（一般指浏览器缓存），这里介绍浏览器缓存机制：
- **HTML Meta** 标签控制缓存:浏览器缓存机制，其实主要就是 HTTP 协议定义的缓存机制（如：`Expires`； `Cache-control`等）。但是也有非 HTTP协议定义的缓存机制，如使用 HTML Meta 标签，Web开发者可以在HTML页面的 `<head>` 节点中加入 `<meta>` 标签
```html
<meta http-equiv="Pragam" content="no-cache">
```
上述代码的作用是告诉浏览器当前页面不被缓存，每次访问都需要去服务器拉取。使用上很简单，但只有部分浏览器可以支持，而且所有缓存代理服务器都不支持，因为代理不解析HTML内容本身。而广泛应用的还是 HTTP头信息 来控制缓存。

- HTTP 响应首部字段 **Expires**，指明缓存的具体过期日期，来控制资源何时过期。在过期时间以内，若再次发起请求，通常浏览器都不会与服务器进行任何通信，而是直接使用本地副本。不过 Expires 是 HTTP 1.0 的东西，现在默认浏览器均默认使用HTTP 1.1，所以它的作用基本忽略。Expires 的一个缺点就是，返回的到期时间是服务器端的时间，这样存在一个问题，如果客户端的时间与服务器的时间相差很大（比如时钟不同步，或者跨时区），那么误差就很大，所以在HTTP 1.1版开始，使用Cache-Control: max-age=秒替代。

- **Cache-Control** HTTP 1.1 协议新增的指令，每个资源都可以通过设定 Cache-Control 来建立缓存策略。通常，可为它指定一个   `max-age` ，表示缓存的最长时间，单位为秒。
 - no-cache，不缓存。
 - public，可以缓存。
 - no-store，请求和响应的信息都不应该被存储在对方的磁盘系统中。
 - must-revalidate，对于客户机的每次请求，代理服务器必须向服务器验证缓存是否过时。

- 控制文件是否有修改 **Last-Modified**/**E-Tag** Last-Modified 表示被请求资源在服务器端的上次修改时间，而 ETag 则是一个唯一文件标识符，每次文件修改后都会生成一个新的 ETag。服务器通过向浏览器发送这两个字段，来告知浏览器其获得的资源的版本。由于 Last-Modified 和 ETag 的作用是相同的（均为向服务器验证资源是否最新），因此只使用一个即可。通常认为 Last-Modified 更好（它和 Expires 不同，由服务器生成，不依赖浏览器端时间）。

- ......


>#### **下图各个参数是什么意思**

![](http://7xpvnv.com2.z0.glb.qiniucdn.com/257149f7-1e11-4262-9b15-159389db83c6)

1.**General**
- Reques URL : 请求资源所在的位置（资源的URL）；
- Request Method : 请求用的是 PUT 方法；
- Status Code : 状态码和原因短语是 200 OK，资源请求成功；
- Remote Address：远程地址。资源所在 IP 地址。

2.**Response Headers**
- Connection：指定连接方式，持久连接；
- Content-Length：主体部分的大小，单位是字节；
- Content-Type：主体内对象的媒体类型，是 json 文件；
- Date：报文创建的日期时间（GMT时间）；
- Server：服务器软件版本信息；
- X-Powered-By：开发资源的技术；是 Express;

3.**Request Headers**
- Accept：能够处理的媒体类型及其相对优先级。`*/*` 可以处理与请求相符的任意媒体类型;
- Accept-Encoding：用户代理支持的内容编码及内容编码的优先级顺序。接受gzip、deflate 和 sdch 格式;
- Accept-Language：用户代理能够处理的自然语言集。接受中文;
- Cookie：之前从服务器获得的 Cookie 信息。
- Host：资源所在的主机;
- Origin：资源所在的源。包括主机，协议和端口号;
- Referer：服务器请求的原始资源的 URI；
- User-Agent：发出请求的客户端（浏览器）信息和用户代理名称；
- X-Requested-With：用何种方式请求。这里使用的是 ajax；









---
